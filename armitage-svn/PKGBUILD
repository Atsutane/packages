# Maintainer: MatToufoutu <mattoufootu[at]gmail.com>

pkgname=armitage-svn
pkgver=137
pkgrel=4
pkgdesc="A graphical cyber attack management tool for Metasploit"
url="http://www.fastandeasyhacking.com/"
arch=('any')
license=('GPL')
depends=('metasploit' 'subversion')
makedepends=('apache-ant' 'zip' 'unzip' 'java-environment')
provides=('armitage')
install=('armitage.install')

source=('armitage.install')
md5sums=('5234326f9ff41ff8694cb35a557af895')

_svntrunk=http://armitage.googlecode.com/svn/trunk/
_svnmod=armitage

build() {
    cd ${srcdir}
    if [ -d ${_svnmod}/.svn ]; then
        svn up ${_svnmod}
    else
        svn co ${_svntrunk} ${_svnmod}
    fi
    cd ${_svnmod}
    sed -i 's|ant|/usr/share/java/apache-ant/bin/ant|g' package.sh
    bash package.sh || return 1
    echo "#!/bin/bash" > ${_svnmod}.sh
    echo "java -jar /opt/${_svnmod}/${_svnmod}.jar" >> ${_svnmod}.sh
}

package() {
    mkdir -p ${pkgdir}/{opt/${_svnmod},usr/bin}
    tar -C ${pkgdir}/opt/ -xzf ${srcdir}/${_svnmod}/${_svnmod}.tgz
    install -m755 ${srcdir}/${_svnmod}/${_svnmod}.sh ${pkgdir}/usr/bin/${_svnmod}
}

